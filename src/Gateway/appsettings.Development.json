{
  "Serilog": {
    "Using": [ "Serilog.Sinks.Console", "Serilog.Sinks.Seq" ],
    "WriteTo": [
      { "Name": "Console" },
      { 
        "Name": "Seq", 
        "Args": {
          "serverUrl": "http://kairos-log:5341",
          "apiKey": "SJLdSMs6uSm1PRjgM1CA"
        }
      }
    ]
  },
  "Health": {
    "Seq": {
      "Url": "http://kairos-log:80/health"
    }
  },
  "EventBus": {
    "HostAddress": "rabbitmq://user:password@kairos-bus:5672",
    "Events": {
      "AccountOpened": {
        "VirtualHost": "account",
        "Exchange": "account-opened",
        "RoutingKeyFormat": "account.opened",
        "Subscribers": [
          {
            "Name": "SendAccountOpenedConfirmationEmail",
            "VirtualHost": "account",
            "Queue": "account.send-account-opened-confirmation-email",
            "RoutingKey": "#",
            "PrefetchCount": 10,
            "RetryIntervals": [ 2, 5, 10 ]
          },
          {
            "Name": "RegisterOpenedAccountInExchange",
            "VirtualHost": "trade",
            "Queue": "exchange.register-opened-account",
            "RoutingKey": "#",
            "PrefetchCount": 5,
            "RetryIntervals": [ 2, 3, 5 ]
          }
        ]
      },
      "OrderChanged": {
        "VirtualHost": "trade",
        "Exchange": "order-changed",
        "RoutingKeyFormat": "order.<type>.<contract-type>.<status>",
        "Subscribers": [
          {
            "Name": "PlaceOrderInExchange",
            "VirtualHost": "trade",
            "Queue": "trade.place-order-in-exchange",
            "RoutingKey": "order.*.*.placed",
            "PrefetchCount": 1,
            "RetryIntervals": [ 1, 2, 5 ]
          },
          {
            "Name": "ChargeInvestorForFilledOrder",
            "VirtualHost": "banking",
            "Queue": "bankaccount.charge-filled-order-value",
            "RoutingKey": "order.purchase.*.filled",
            "PrefetchCount": 1,
            "RetryIntervals": [ 1, 2, 5 ]
          },
          {
            "Name": "PayInvestorForFilledOrder",
            "VirtualHost": "banking",
            "Queue": "bankaccount.pay-filled-order-value",
            "RoutingKey": "order.sale.*.filled",
            "PrefetchCount": 1,
            "RetryIntervals": [ 1, 2, 5 ]
          },
          {
            "Name": "ApplyFilledOrderToPortfolio",
            "VirtualHost": "position",
            "Queue": "portfolio.apply-filled-order",
            "RoutingKey": "order.*.*.filled",
            "PrefetchCount": 5,
            "RetryIntervals": [ 2, 3, 5 ]
          },
          {
            "Name": "SendFilledOrderEmail",
            "VirtualHost": "trade",
            "Queue": "trade.send-filled-order-email",
            "RoutingKey": "order.*.*.filled",
            "PrefetchCount": 5,
            "RetryIntervals": [ 2, 3, 5 ]
          }
        ]
      }
    },
    "Commands": {
      "SendEmail": {
        "VirtualHost": "notification",
        "Exchange": "send-email",
        "Queue": "notifier.send-email",
        "PrefetchCount": 1,
        "RetryIntervals": [ 2, 5, 10 ]
      }
    }
  }
}
